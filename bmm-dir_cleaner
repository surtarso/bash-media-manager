#! /bin/bash

##TODO: -log stuff

## load enviroment variables
if [ -f $HOME/bmm/.env ]; then
    . $HOME/bmm/.env
else
    echo -e "FATAL ERROR: .env not found.$\n
	Use bmm-setup_enviroment to create one.\nAborting...";
    exit 1;
fi

#enter music root dir
if ! command -v $BANNER >> /dev/null; then echo -e "${WARN}BASH MEDIA MANAGER${NC}"; else eval $BANNER; fi
echo '----------------------------------------------------------'
dir_check "$AUDIOROOT"
cd "$AUDIOROOT" || { echo 'ERROR: Could not enter directory.'; exit 1; };
echo -e "${OK}Searching for folders with no MP3 in ${WARN}$AUDIOROOT${NC}"
echo '----------------------------------------------------------'

##TODO: Warn user that this only reads mp3
## and suggest converter mp3 full run before doing this.



#search for folder with no mp3 in them
#does not delete nested folders (artist(no mp3)/album(mp3)) etc

find -depth -type d | while read -r D
    do
    v=$(find "$D" -iname '*.mp3')
        case "$v" in
            ""  )
                echo "$D has no MP3, removing..."
                ##TODO: list all dir contens
                ##	ask user if ok to delete.
                rm -rf "$D" #REMOVE COMMAND
                ;;
        esac
done

echo 'Done.'